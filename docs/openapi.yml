openapi: 3.1.0
info:
  title: Events API
  version: 1.0.0

paths:
  /api/v1/join:
    post:
      summary: Create an account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nickname, email, password, role]
              properties:
                nickname:
                  type: string
                  minLength: 2
                  maxLength: 32
                email:
                  type: string
                  format: email
                  maxLength: 254
                password:
                  type: string
                  minLength: 8
                  maxLength: 128
                role:
                  type: string
                  enum: [admin, member]
      responses:
        "201":
          description: Account created
        "400":
          $ref: "#/components/responses/ValidationException"
        "409":
          description: Email or nickname already taken
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              examples:
                emailTaken:
                  value:
                    code: EMAIL_ALREADY_TAKEN_EXCEPTION
                nicknameTaken:
                  value:
                    code: NICKNAME_ALREADY_TAKEN_EXCEPTION

  /api/v1/enter:
    post:
      summary: Log in
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        "200":
          description: Tokens returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPair"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: INVALID_CREDENTIALS_EXCEPTION

  /api/v1/refresh:
    post:
      summary: Refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        "200":
          description: New token pair returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPair"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: INVALID_REFRESH_TOKEN_EXCEPTION

  /api/v1/logout:
    post:
      summary: End current session
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        "200":
          description: Session ended
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          description: Session not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: SESSION_NOT_FOUND_EXCEPTION

  /api/v1/logout-all:
    post:
      summary: End all sessions
      security:
        - bearerAuth: []
      responses:
        "200":
          description: All sessions ended
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/humans:
    get:
      summary: Search humans by nickname
      security:
        - bearerAuth: []
      parameters:
        - name: nickname
          in: query
          required: true
          description: Partial nickname search (min 2 chars, case-insensitive)
          schema:
            type: string
            minLength: 2
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 50
      responses:
        "200":
          description: List of matching humans
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    nickname:
                      type: string
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/organisations:
    post:
      summary: Create organisation (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
      responses:
        "201":
          description: Organisation created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organisation"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          description: Name already taken
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: ORGANISATION_NAME_ALREADY_TAKEN_EXCEPTION

    get:
      summary: List organisations
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: name
          in: query
          description: Partial name search (case-insensitive)
          schema:
            type: string
        - name: onlyFavourites
          in: query
          description: When "true", only return favourited organisations
          schema:
            type: string
            enum: ["true"]
      responses:
        "200":
          description: Paginated list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/Organisation"
                        - type: object
                          properties:
                            isFavourite:
                              type: boolean
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/organisations/{id}:
    get:
      summary: Get organisation by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Organisation found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organisation"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      summary: Update organisation (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
      responses:
        "200":
          description: Organisation updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organisation"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Name already taken
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: ORGANISATION_NAME_ALREADY_TAKEN_EXCEPTION

    delete:
      summary: Delete organisation (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Organisation deleted
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/countries:
    post:
      summary: Create country (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
      responses:
        "201":
          description: Country created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Country"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          description: Name already taken
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: COUNTRY_NAME_ALREADY_TAKEN_EXCEPTION

    get:
      summary: List countries
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: name
          in: query
          description: Partial name search (case-insensitive)
          schema:
            type: string
      responses:
        "200":
          description: Paginated list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Country"
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/countries/{id}:
    get:
      summary: Get country by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Country found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Country"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      summary: Update country (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
      responses:
        "200":
          description: Country updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Country"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Name already taken
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: COUNTRY_NAME_ALREADY_TAKEN_EXCEPTION

    delete:
      summary: Delete country (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Country deleted
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Country has dependent cities
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: COUNTRY_HAS_DEPENDENCIES_EXCEPTION

  /api/v1/cities:
    post:
      summary: Create city (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, countryId]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
                countryId:
                  type: string
                  format: uuid
      responses:
        "201":
          description: City created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CityBase"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: Country not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: RESOURCE_NOT_FOUND_EXCEPTION

    get:
      summary: List cities
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: name
          in: query
          description: Partial name search (case-insensitive)
          schema:
            type: string
        - name: countryId
          in: query
          description: Filter by country
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Paginated list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/City"
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/cities/{id}:
    get:
      summary: Get city by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: City found with country name
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/City"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      summary: Update city (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, countryId]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
                countryId:
                  type: string
                  format: uuid
      responses:
        "200":
          description: City updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CityBase"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      summary: Delete city (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: City deleted
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: City has dependent places
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: CITY_HAS_DEPENDENCIES_EXCEPTION

  /api/v1/places:
    post:
      summary: Create place (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, address, latitude, longitude, cityId]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
                address:
                  type: string
                  minLength: 1
                latitude:
                  type: number
                  minimum: -90
                  maximum: 90
                longitude:
                  type: number
                  minimum: -180
                  maximum: 180
                cityId:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Place created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlaceBase"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: City not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: RESOURCE_NOT_FOUND_EXCEPTION

    get:
      summary: List places
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: search
          in: query
          description: Search by name or address (case-insensitive)
          schema:
            type: string
        - name: cityId
          in: query
          description: Filter by city
          schema:
            type: string
            format: uuid
        - name: onlyFavourites
          in: query
          description: When "true", only return favourited places
          schema:
            type: string
            enum: ["true"]
      responses:
        "200":
          description: Paginated list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/Place"
                        - type: object
                          properties:
                            isFavourite:
                              type: boolean
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/places/{id}:
    get:
      summary: Get place by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Place found with city and country names
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Place"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      summary: Update place (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, address, latitude, longitude, cityId]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 256
                address:
                  type: string
                  minLength: 1
                latitude:
                  type: number
                  minimum: -90
                  maximum: 90
                longitude:
                  type: number
                  minimum: -180
                  maximum: 180
                cityId:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Place updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlaceBase"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      summary: Delete place (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Place deleted
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Place has dependent events
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: PLACE_HAS_EVENTS_EXCEPTION

  /api/v1/events:
    post:
      summary: Create event (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, description, placeId, startDate, endDate]
              properties:
                title:
                  type: string
                  minLength: 1
                  maxLength: 256
                description:
                  type: string
                placeId:
                  type: string
                  format: uuid
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
                organisationId:
                  type: string
                  format: uuid
                  nullable: true
      responses:
        "201":
          description: Event created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EventBase"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: Place or organisation not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: RESOURCE_NOT_FOUND_EXCEPTION

    get:
      summary: List events (upcoming only, ordered by start date)
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: search
          in: query
          description: Search by event title, place name, or organisation name (case-insensitive)
          schema:
            type: string
        - name: cityId
          in: query
          description: Filter events by city
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Paginated list of events
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/events/area:
    get:
      summary: Get events within a geographic area (max 10x10 km)
      security:
        - bearerAuth: []
      parameters:
        - name: minLat
          in: query
          required: true
          schema:
            type: number
            minimum: -90
            maximum: 90
        - name: maxLat
          in: query
          required: true
          schema:
            type: number
            minimum: -90
            maximum: 90
        - name: minLng
          in: query
          required: true
          schema:
            type: number
            minimum: -180
            maximum: 180
        - name: maxLng
          in: query
          required: true
          schema:
            type: number
            minimum: -180
            maximum: 180
      responses:
        "200":
          description: All events within the area
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
        "400":
          description: Validation error or area exceeds 10x10 km
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              examples:
                validation:
                  value:
                    code: VALIDATION_EXCEPTION
                    violations:
                      - property: minLat
                        message: "Invalid number"
                areaTooLarge:
                  value:
                    code: AREA_TOO_LARGE_EXCEPTION
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/events/{id}:
    get:
      summary: Get event by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Event found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Event"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      summary: Update event (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, description, placeId, startDate, endDate]
              properties:
                title:
                  type: string
                  minLength: 1
                  maxLength: 256
                description:
                  type: string
                placeId:
                  type: string
                  format: uuid
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
                organisationId:
                  type: string
                  format: uuid
                  nullable: true
      responses:
        "200":
          description: Event updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EventBase"
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: Event, place, or organisation not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorCode"
              example:
                code: RESOURCE_NOT_FOUND_EXCEPTION

    delete:
      summary: Delete event (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Event deleted
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/places/{placeId}/events:
    get:
      summary: List events for a place
      security:
        - bearerAuth: []
      parameters:
        - name: placeId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        "200":
          description: Paginated list of events
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/organisations/{organisationId}/events:
    get:
      summary: List events for an organisation
      security:
        - bearerAuth: []
      parameters:
        - name: organisationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        "200":
          description: Paginated list of events
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/favourite-organisations:
    post:
      summary: Add organisation to favourites
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [organisationId]
              properties:
                organisationId:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Added (or already exists)
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/favourite-organisations/{organisationId}:
    delete:
      summary: Remove organisation from favourites
      security:
        - bearerAuth: []
      parameters:
        - name: organisationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Removed (idempotent)
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/favourite-places:
    post:
      summary: Add place to favourites
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [placeId]
              properties:
                placeId:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Added (or already exists)
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/favourite-places/{placeId}:
    delete:
      summary: Remove place from favourites
      security:
        - bearerAuth: []
      parameters:
        - name: placeId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Removed (idempotent)
        "400":
          $ref: "#/components/responses/ValidationException"
        "401":
          $ref: "#/components/responses/Unauthorized"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorCode:
      type: object
      required: [code]
      properties:
        code:
          type: string

    TokenPair:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string

    Organisation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        humanId:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time

    Country:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CityBase:
      description: City as returned by create/update (without joined country name)
      type: object
      properties:
        id:
          type: string
          format: uuid
        countryId:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    City:
      description: City as returned by list/get (with joined country name)
      allOf:
        - $ref: "#/components/schemas/CityBase"
        - type: object
          properties:
            countryName:
              type: string

    PlaceBase:
      description: Place as returned by create/update (without joined city/country names)
      type: object
      properties:
        id:
          type: string
          format: uuid
        cityId:
          type: string
          format: uuid
        name:
          type: string
        address:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Place:
      description: Place as returned by list/get (with joined city and country names)
      allOf:
        - $ref: "#/components/schemas/PlaceBase"
        - type: object
          properties:
            cityName:
              type: string
            countryName:
              type: string

    EventBase:
      description: Event as returned by create/update (without joined place/org data)
      type: object
      properties:
        id:
          type: string
          format: uuid
        humanId:
          type: string
          format: uuid
        organisationId:
          type: string
          format: uuid
          nullable: true
        placeId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    Event:
      description: Event as returned by list/get (with joined place and organisation data)
      allOf:
        - $ref: "#/components/schemas/EventBase"
        - type: object
          properties:
            latitude:
              type: number
            longitude:
              type: number
            placeName:
              type: string
            placeAddress:
              type: string
            organisationName:
              type: string
              nullable: true

  responses:
    ValidationException:
      description: Validation failed
      content:
        application/json:
          schema:
            type: object
            required: [code, violations]
            properties:
              code:
                type: string
                enum: [VALIDATION_EXCEPTION]
              violations:
                type: array
                items:
                  type: object
                  required: [property, message]
                  properties:
                    property:
                      type: string
                    message:
                      type: string
          example:
            code: VALIDATION_EXCEPTION
            violations:
              - property: nickname
                message: "Invalid length: Expected >=2 but received 1"
              - property: role
                message: "Invalid type: Expected \"admin\" | \"member\" but received \"foo\""

    Unauthorized:
      description: Missing or invalid token
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorCode"
          example:
            code: UNAUTHORIZED_EXCEPTION

    Forbidden:
      description: Admin only
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorCode"
          example:
            code: FORBIDDEN_EXCEPTION

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorCode"
          example:
            code: RESOURCE_NOT_FOUND_EXCEPTION
